{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import express from\"express\";import fs from\"fs\";import{nanoid}from\"nanoid\";import path from\"path\";import{createServer as createViteServer}from\"vite\";import viteConfig from\"../../vite.config\";async function setupVite(app,server){const serverOptions={middlewareMode:true,hmr:{server},allowedHosts:true};const vite=await createViteServer({...viteConfig,configFile:false,server:serverOptions,appType:\"custom\"});app.use(vite.middlewares);app.use(\"*\",async(req,res,next)=>{const url=req.originalUrl;try{const clientTemplate=path.resolve(import.meta.dirname,\"../..\",\"client\",\"index.html\");let template=await fs.promises.readFile(clientTemplate,\"utf-8\");template=template.replace(`src=\"/src/main.tsx\"`,`src=\"/src/main.tsx?v=${nanoid()}\"`);const page=await vite.transformIndexHtml(url,template);res.status(200).set({\"Content-Type\":\"text/html\"}).end(page)}catch(e){vite.ssrFixStacktrace(e);next(e)}})}__name(setupVite,\"setupVite\");function serveStatic(app){const distPath=process.env.NODE_ENV===\"development\"?path.resolve(import.meta.dirname,\"../..\",\"dist\",\"public\"):path.resolve(import.meta.dirname,\"public\");if(!fs.existsSync(distPath)){console.error(`Could not find the build directory: ${distPath}, make sure to build the client first`)}app.use(express.static(distPath));app.use(\"*\",(_req,res)=>{res.sendFile(path.resolve(distPath,\"index.html\"))})}__name(serveStatic,\"serveStatic\");export{serveStatic,setupVite};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAO,YAA+B,UACtC,OAAO,OAAQ,KAEf,OAAS,WAAc,SACvB,OAAO,SAAU,OACjB,OAAS,gBAAgB,qBAAwB,OACjD,OAAO,eAAgB,oBAEvB,eAAsB,UAAU,IAAc,OAAgB,CAC5D,MAAM,cAAgB,CACpB,eAAgB,KAChB,IAAK,CAAE,MAAO,EACd,aAAc,IAChB,EAEA,MAAM,KAAO,MAAM,iBAAiB,CAClC,GAAG,WACH,WAAY,MACZ,OAAQ,cACR,QAAS,QACX,CAAC,EAED,IAAI,IAAI,KAAK,WAAW,EACxB,IAAI,IAAI,IAAK,MAAO,IAAK,IAAK,OAAS,CACrC,MAAM,IAAM,IAAI,YAEhB,GAAI,CACF,MAAM,eAAiB,KAAK,QAC1B,YAAY,QACZ,QACA,SACA,YACF,EAGA,IAAI,SAAW,MAAM,GAAG,SAAS,SAAS,eAAgB,OAAO,EACjE,SAAW,SAAS,QAClB,sBACA,wBAAwB,OAAO,CAAC,GAClC,EACA,MAAM,KAAO,MAAM,KAAK,mBAAmB,IAAK,QAAQ,EACxD,IAAI,OAAO,GAAG,EAAE,IAAI,CAAE,eAAgB,WAAY,CAAC,EAAE,IAAI,IAAI,CAC/D,OAAS,EAAG,CACV,KAAK,iBAAiB,CAAU,EAChC,KAAK,CAAC,CACR,CACF,CAAC,CACH,CAvCsB,8BAyCf,SAAS,YAAY,IAAc,CACxC,MAAM,SACJ,QAAQ,IAAI,WAAa,cACrB,KAAK,QAAQ,YAAY,QAAS,QAAS,OAAQ,QAAQ,EAC3D,KAAK,QAAQ,YAAY,QAAS,QAAQ,EAChD,GAAI,CAAC,GAAG,WAAW,QAAQ,EAAG,CAC5B,QAAQ,MACN,uCAAuC,QAAQ,uCACjD,CACF,CAEA,IAAI,IAAI,QAAQ,OAAO,QAAQ,CAAC,EAGhC,IAAI,IAAI,IAAK,CAAC,KAAM,MAAQ,CAC1B,IAAI,SAAS,KAAK,QAAQ,SAAU,YAAY,CAAC,CACnD,CAAC,CACH,CAjBgB","names":[],"ignoreList":[],"sources":["/home/ubuntu/openclaw-concierge/server/_core/vite.ts"],"sourcesContent":[null]}}