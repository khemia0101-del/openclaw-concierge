{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import axios from\"axios\";const STRIPE_SECRET_KEY=process.env.STRIPE_SECRET_KEY||\"\";const STRIPE_API_BASE=\"https://api.stripe.com/v1\";const PRICING={starter:{setupFee:5e4,monthlyPrice:9900},pro:{setupFee:75e3,monthlyPrice:19900},business:{setupFee:1e5,monthlyPrice:29900}};async function createCheckoutSession(params){const{customerEmail,tier,userId,successUrl,cancelUrl}=params;const pricing=PRICING[tier];try{const formData=new URLSearchParams;formData.append(\"mode\",\"payment\");formData.append(\"customer_email\",customerEmail);formData.append(\"success_url\",successUrl);formData.append(\"cancel_url\",cancelUrl);formData.append(\"client_reference_id\",userId.toString());formData.append(\"metadata[userId]\",userId.toString());formData.append(\"metadata[tier]\",tier);formData.append(\"line_items[0][price_data][currency]\",\"usd\");formData.append(\"line_items[0][price_data][product_data][name]\",`${tier.charAt(0).toUpperCase()+tier.slice(1)} Plan - Setup Fee`);formData.append(\"line_items[0][price_data][product_data][description]\",\"One-time setup and configuration fee\");formData.append(\"line_items[0][price_data][unit_amount]\",pricing.setupFee.toString());formData.append(\"line_items[0][quantity]\",\"1\");formData.append(\"line_items[1][price_data][currency]\",\"usd\");formData.append(\"line_items[1][price_data][product_data][name]\",`${tier.charAt(0).toUpperCase()+tier.slice(1)} Plan - First Month`);formData.append(\"line_items[1][price_data][product_data][description]\",\"Monthly subscription fee\");formData.append(\"line_items[1][price_data][unit_amount]\",pricing.monthlyPrice.toString());formData.append(\"line_items[1][quantity]\",\"1\");const response=await axios.post(`${STRIPE_API_BASE}/checkout/sessions`,formData.toString(),{headers:{\"Authorization\":`Bearer ${STRIPE_SECRET_KEY}`,\"Content-Type\":\"application/x-www-form-urlencoded\"}});return response.data}catch(error){console.error(\"[Stripe] Failed to create checkout session:\",error.response?.data||error.message);throw new Error(\"Failed to create payment session\")}}__name(createCheckoutSession,\"createCheckoutSession\");async function getCheckoutSession(sessionId){try{const response=await axios.get(`${STRIPE_API_BASE}/checkout/sessions/${sessionId}`,{headers:{\"Authorization\":`Bearer ${STRIPE_SECRET_KEY}`}});return response.data}catch(error){console.error(\"[Stripe] Failed to retrieve checkout session:\",error.response?.data||error.message);throw new Error(\"Failed to retrieve payment session\")}}__name(getCheckoutSession,\"getCheckoutSession\");async function createCustomer(email,name){try{const formData=new URLSearchParams;formData.append(\"email\",email);if(name){formData.append(\"name\",name)}const response=await axios.post(`${STRIPE_API_BASE}/customers`,formData.toString(),{headers:{\"Authorization\":`Bearer ${STRIPE_SECRET_KEY}`,\"Content-Type\":\"application/x-www-form-urlencoded\"}});return response.data}catch(error){console.error(\"[Stripe] Failed to create customer:\",error.response?.data||error.message);throw new Error(\"Failed to create customer\")}}__name(createCustomer,\"createCustomer\");function verifyWebhookSignature(payload,signature,secret){return true}__name(verifyWebhookSignature,\"verifyWebhookSignature\");export{PRICING,createCheckoutSession,createCustomer,getCheckoutSession,verifyWebhookSignature};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAO,UAAW,QAGlB,MAAM,kBAAoB,QAAQ,IAAI,mBAAqB,GAC3D,MAAM,gBAAkB,4BAkBjB,MAAM,QAAU,CACrB,QAAS,CACP,SAAU,IACV,aAAc,IAChB,EACA,IAAK,CACH,SAAU,KACV,aAAc,KAChB,EACA,SAAU,CACR,SAAU,IACV,aAAc,KAChB,CACF,EAKA,eAAsB,sBACpB,OAC0B,CAC1B,KAAM,CAAE,cAAe,KAAM,OAAQ,WAAY,SAAU,EAAI,OAC/D,MAAM,QAAU,QAAQ,IAAI,EAE5B,GAAI,CACF,MAAM,SAAW,IAAI,gBACrB,SAAS,OAAO,OAAQ,SAAS,EACjC,SAAS,OAAO,iBAAkB,aAAa,EAC/C,SAAS,OAAO,cAAe,UAAU,EACzC,SAAS,OAAO,aAAc,SAAS,EACvC,SAAS,OAAO,sBAAuB,OAAO,SAAS,CAAC,EACxD,SAAS,OAAO,mBAAoB,OAAO,SAAS,CAAC,EACrD,SAAS,OAAO,iBAAkB,IAAI,EAGtC,SAAS,OAAO,sCAAuC,KAAK,EAC5D,SAAS,OAAO,gDAAiD,GAAG,KAAK,OAAO,CAAC,EAAE,YAAY,EAAI,KAAK,MAAM,CAAC,CAAC,mBAAmB,EACnI,SAAS,OAAO,uDAAwD,sCAAsC,EAC9G,SAAS,OAAO,yCAA0C,QAAQ,SAAS,SAAS,CAAC,EACrF,SAAS,OAAO,0BAA2B,GAAG,EAG9C,SAAS,OAAO,sCAAuC,KAAK,EAC5D,SAAS,OAAO,gDAAiD,GAAG,KAAK,OAAO,CAAC,EAAE,YAAY,EAAI,KAAK,MAAM,CAAC,CAAC,qBAAqB,EACrI,SAAS,OAAO,uDAAwD,0BAA0B,EAClG,SAAS,OAAO,yCAA0C,QAAQ,aAAa,SAAS,CAAC,EACzF,SAAS,OAAO,0BAA2B,GAAG,EAE9C,MAAM,SAAW,MAAM,MAAM,KAC3B,GAAG,eAAe,qBAClB,SAAS,SAAS,EAClB,CACE,QAAS,CACP,gBAAiB,UAAU,iBAAiB,GAC5C,eAAgB,mCAClB,CACF,CACF,EAEA,OAAO,SAAS,IAClB,OAAS,MAAY,CACnB,QAAQ,MAAM,8CAA+C,MAAM,UAAU,MAAQ,MAAM,OAAO,EAClG,MAAM,IAAI,MAAM,kCAAkC,CACpD,CACF,CA9CsB,sDAmDtB,eAAsB,mBAAmB,UAAiC,CACxE,GAAI,CACF,MAAM,SAAW,MAAM,MAAM,IAC3B,GAAG,eAAe,sBAAsB,SAAS,GACjD,CACE,QAAS,CACP,gBAAiB,UAAU,iBAAiB,EAC9C,CACF,CACF,EACA,OAAO,SAAS,IAClB,OAAS,MAAY,CACnB,QAAQ,MAAM,gDAAiD,MAAM,UAAU,MAAQ,MAAM,OAAO,EACpG,MAAM,IAAI,MAAM,oCAAoC,CACtD,CACF,CAfsB,gDAoBtB,eAAsB,eAAe,MAAe,KAA6B,CAC/E,GAAI,CACF,MAAM,SAAW,IAAI,gBACrB,SAAS,OAAO,QAAS,KAAK,EAC9B,GAAI,KAAM,CACR,SAAS,OAAO,OAAQ,IAAI,CAC9B,CAEA,MAAM,SAAW,MAAM,MAAM,KAC3B,GAAG,eAAe,aAClB,SAAS,SAAS,EAClB,CACE,QAAS,CACP,gBAAiB,UAAU,iBAAiB,GAC5C,eAAgB,mCAClB,CACF,CACF,EAEA,OAAO,SAAS,IAClB,OAAS,MAAY,CACnB,QAAQ,MAAM,sCAAuC,MAAM,UAAU,MAAQ,MAAM,OAAO,EAC1F,MAAM,IAAI,MAAM,2BAA2B,CAC7C,CACF,CAxBsB,wCA6Bf,SAAS,uBACd,QACA,UACA,OACS,CAGT,MAAO,KACT,CARgB","names":[],"ignoreList":[],"sources":["/home/ubuntu/openclaw-concierge/server/services/stripe.ts"],"sourcesContent":[null]}}