{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{TRPCError}from\"@trpc/server\";import{ENV}from\"./env\";const TITLE_MAX_LENGTH=1200;const CONTENT_MAX_LENGTH=2e4;const trimValue=__name(value=>value.trim(),\"trimValue\");const isNonEmptyString=__name(value=>typeof value===\"string\"&&value.trim().length>0,\"isNonEmptyString\");const buildEndpointUrl=__name(baseUrl=>{const normalizedBase=baseUrl.endsWith(\"/\")?baseUrl:`${baseUrl}/`;return new URL(\"webdevtoken.v1.WebDevService/SendNotification\",normalizedBase).toString()},\"buildEndpointUrl\");const validatePayload=__name(input=>{if(!isNonEmptyString(input.title)){throw new TRPCError({code:\"BAD_REQUEST\",message:\"Notification title is required.\"})}if(!isNonEmptyString(input.content)){throw new TRPCError({code:\"BAD_REQUEST\",message:\"Notification content is required.\"})}const title=trimValue(input.title);const content=trimValue(input.content);if(title.length>TITLE_MAX_LENGTH){throw new TRPCError({code:\"BAD_REQUEST\",message:`Notification title must be at most ${TITLE_MAX_LENGTH} characters.`})}if(content.length>CONTENT_MAX_LENGTH){throw new TRPCError({code:\"BAD_REQUEST\",message:`Notification content must be at most ${CONTENT_MAX_LENGTH} characters.`})}return{title,content}},\"validatePayload\");async function notifyOwner(payload){const{title,content}=validatePayload(payload);if(!ENV.forgeApiUrl){throw new TRPCError({code:\"INTERNAL_SERVER_ERROR\",message:\"Notification service URL is not configured.\"})}if(!ENV.forgeApiKey){throw new TRPCError({code:\"INTERNAL_SERVER_ERROR\",message:\"Notification service API key is not configured.\"})}const endpoint=buildEndpointUrl(ENV.forgeApiUrl);try{const response=await fetch(endpoint,{method:\"POST\",headers:{accept:\"application/json\",authorization:`Bearer ${ENV.forgeApiKey}`,\"content-type\":\"application/json\",\"connect-protocol-version\":\"1\"},body:JSON.stringify({title,content})});if(!response.ok){const detail=await response.text().catch(()=>\"\");console.warn(`[Notification] Failed to notify owner (${response.status} ${response.statusText})${detail?`: ${detail}`:\"\"}`);return false}return true}catch(error){console.warn(\"[Notification] Error calling notification service:\",error);return false}}__name(notifyOwner,\"notifyOwner\");export{notifyOwner};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,cAAiB,eAC1B,OAAS,QAAW,QAOpB,MAAM,iBAAmB,KACzB,MAAM,mBAAqB,IAE3B,MAAM,UAAY,OAAC,OAA0B,MAAM,KAAK,EAAtC,aAClB,MAAM,iBAAmB,OAAC,OACxB,OAAO,QAAU,UAAY,MAAM,KAAK,EAAE,OAAS,EAD5B,oBAGzB,MAAM,iBAAmB,OAAC,SAA4B,CACpD,MAAM,eAAiB,QAAQ,SAAS,GAAG,EACvC,QACA,GAAG,OAAO,IACd,OAAO,IAAI,IACT,gDACA,cACF,EAAE,SAAS,CACb,EARyB,oBAUzB,MAAM,gBAAkB,OAAC,OAAoD,CAC3E,GAAI,CAAC,iBAAiB,MAAM,KAAK,EAAG,CAClC,MAAM,IAAI,UAAU,CAClB,KAAM,cACN,QAAS,iCACX,CAAC,CACH,CACA,GAAI,CAAC,iBAAiB,MAAM,OAAO,EAAG,CACpC,MAAM,IAAI,UAAU,CAClB,KAAM,cACN,QAAS,mCACX,CAAC,CACH,CAEA,MAAM,MAAQ,UAAU,MAAM,KAAK,EACnC,MAAM,QAAU,UAAU,MAAM,OAAO,EAEvC,GAAI,MAAM,OAAS,iBAAkB,CACnC,MAAM,IAAI,UAAU,CAClB,KAAM,cACN,QAAS,sCAAsC,gBAAgB,cACjE,CAAC,CACH,CAEA,GAAI,QAAQ,OAAS,mBAAoB,CACvC,MAAM,IAAI,UAAU,CAClB,KAAM,cACN,QAAS,wCAAwC,kBAAkB,cACrE,CAAC,CACH,CAEA,MAAO,CAAE,MAAO,OAAQ,CAC1B,EAhCwB,mBAwCxB,eAAsB,YACpB,QACkB,CAClB,KAAM,CAAE,MAAO,OAAQ,EAAI,gBAAgB,OAAO,EAElD,GAAI,CAAC,IAAI,YAAa,CACpB,MAAM,IAAI,UAAU,CAClB,KAAM,wBACN,QAAS,6CACX,CAAC,CACH,CAEA,GAAI,CAAC,IAAI,YAAa,CACpB,MAAM,IAAI,UAAU,CAClB,KAAM,wBACN,QAAS,iDACX,CAAC,CACH,CAEA,MAAM,SAAW,iBAAiB,IAAI,WAAW,EAEjD,GAAI,CACF,MAAM,SAAW,MAAM,MAAM,SAAU,CACrC,OAAQ,OACR,QAAS,CACP,OAAQ,mBACR,cAAe,UAAU,IAAI,WAAW,GACxC,eAAgB,mBAChB,2BAA4B,GAC9B,EACA,KAAM,KAAK,UAAU,CAAE,MAAO,OAAQ,CAAC,CACzC,CAAC,EAED,GAAI,CAAC,SAAS,GAAI,CAChB,MAAM,OAAS,MAAM,SAAS,KAAK,EAAE,MAAM,IAAM,EAAE,EACnD,QAAQ,KACN,0CAA0C,SAAS,MAAM,IAAI,SAAS,UAAU,IAC9E,OAAS,KAAK,MAAM,GAAK,EAC3B,EACF,EACA,MAAO,MACT,CAEA,MAAO,KACT,OAAS,MAAO,CACd,QAAQ,KAAK,qDAAsD,KAAK,EACxE,MAAO,MACT,CACF,CAhDsB","names":[],"ignoreList":[],"sources":["/home/ubuntu/openclaw-concierge/server/_core/notification.ts"],"sourcesContent":[null]}}