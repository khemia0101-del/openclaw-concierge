{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import axios from\"axios\";const DO_API_TOKEN=process.env.DO_API_TOKEN||\"\";const DO_API_BASE=\"https://api.digitalocean.com/v2\";async function createOpenClawApp(params){const{userId,userEmail,aiRole,tier,telegramBotToken,config}=params;const instanceSizes={starter:\"basic-xxs\",pro:\"basic-xs\",business:\"basic-s\"};const appSpec={name:`openclaw-${userId}-${Date.now()}`,region:\"nyc\",services:[{name:\"openclaw-instance\",image:{registry_type:\"DOCKER_HUB\",repository:\"openclawai/openclaw\",tag:\"latest\"},instance_count:1,instance_size_slug:instanceSizes[tier],envs:[{key:\"USER_ID\",value:userId.toString(),scope:\"RUN_TIME\"},{key:\"USER_EMAIL\",value:userEmail,scope:\"RUN_TIME\"},{key:\"AI_ROLE\",value:aiRole,scope:\"RUN_TIME\"},{key:\"TELEGRAM_BOT_TOKEN\",value:telegramBotToken||\"\",scope:\"RUN_TIME\"},{key:\"CONFIG_JSON\",value:JSON.stringify(config),scope:\"RUN_TIME\"}],http_port:8080}]};try{const response=await axios.post(`${DO_API_BASE}/apps`,{spec:appSpec},{headers:{\"Authorization\":`Bearer ${DO_API_TOKEN}`,\"Content-Type\":\"application/json\"}});return response.data.app}catch(error){console.error(\"[DigitalOcean] Failed to create app:\",error.response?.data||error.message);throw new Error(\"Failed to provision AI instance\")}}__name(createOpenClawApp,\"createOpenClawApp\");async function getApp(appId){try{const response=await axios.get(`${DO_API_BASE}/apps/${appId}`,{headers:{\"Authorization\":`Bearer ${DO_API_TOKEN}`}});return response.data.app}catch(error){console.error(\"[DigitalOcean] Failed to get app:\",error.response?.data||error.message);throw new Error(\"Failed to retrieve app details\")}}__name(getApp,\"getApp\");async function getDeploymentStatus(appId){try{const app=await getApp(appId);return app.active_deployment?.phase||\"unknown\"}catch(error){return\"error\"}}__name(getDeploymentStatus,\"getDeploymentStatus\");async function deleteApp(appId){try{await axios.delete(`${DO_API_BASE}/apps/${appId}`,{headers:{\"Authorization\":`Bearer ${DO_API_TOKEN}`}})}catch(error){console.error(\"[DigitalOcean] Failed to delete app:\",error.response?.data||error.message);throw new Error(\"Failed to delete app\")}}__name(deleteApp,\"deleteApp\");async function restartApp(appId){try{await axios.post(`${DO_API_BASE}/apps/${appId}/deployments`,{force_build:false},{headers:{\"Authorization\":`Bearer ${DO_API_TOKEN}`,\"Content-Type\":\"application/json\"}})}catch(error){console.error(\"[DigitalOcean] Failed to restart app:\",error.response?.data||error.message);throw new Error(\"Failed to restart app\")}}__name(restartApp,\"restartApp\");async function getAppLogs(appId,componentName=\"openclaw-instance\"){try{const response=await axios.get(`${DO_API_BASE}/apps/${appId}/components/${componentName}/logs`,{headers:{\"Authorization\":`Bearer ${DO_API_TOKEN}`},params:{type:\"RUN\",follow:false,tail_lines:100}});return response.data.logs||[]}catch(error){console.error(\"[DigitalOcean] Failed to get logs:\",error.response?.data||error.message);return[]}}__name(getAppLogs,\"getAppLogs\");export{createOpenClawApp,deleteApp,getApp,getAppLogs,getDeploymentStatus,restartApp};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/home/ubuntu/openclaw-concierge/server/services/digitalocean.ts"],"sourcesContent":[null]}}